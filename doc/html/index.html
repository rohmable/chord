<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Chord: Chord</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Chord
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Chord </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>This project uses the <b>Chord</b> algorithm to implement a simple <b>mail</b> system where the server is not centralized and nodes can be added and removed as needed.</p>
<h1><a class="anchor" id="algorithm_sec"></a>
Algorithm</h1>
<p>The Chord algorithm is a peer-to-peer algorithm that can implement a distributed hash table.</p>
<p>A distributed hash table (DHT) handles key-value pairs where data (the value) can be associated to a key and later retrieved. In an hash table there are three primitive operations done one these \( (k, v) \) pairs:</p><ul>
<li><b>Insert</b>: a \( (k, v) \) is pushed inside the hash table</li>
<li><b>Search</b>: given a key \( k \) the table returns the associated value \( v \) (if exists)</li>
<li><b>Delete</b>: a \( (k, v) \) pair is removed from the hash table</li>
</ul>
<p>The difference between an hash table and a <em>distributed</em> hash table is that these pairs are distributed among different nodes and these nodes are not known and their number can change dinamically with time.</p>
<p>In this algorithm each node has an identifier number of \( m \) bits. These ids are the result of a hashing function (usually SHA-1) and will belong to a <b>circular space</b> of \( [0, 2^m - 1] \), this means that the extremes of this space will be connected toghether, forming a <b>ring</b> and each node has a pointer to his <b>successor</b>.</p>
<p>The keys will also be hashed to the same space, in this way we can associate each key to a node, called his <b>successor node</b> that is the first node where \( Node ID \geq key \).</p>
<p>With these rules we can then implement the primitives above by starting from any node in the ring and then forwarding the request through each successor until we reach the successor node for the given key and then go back with the value if we're doing a search or inserting/deleting the pair.</p>
<p>To avoid to forward the request to each successor we can also build for every node a <b>finger table</b>, this table is composed of \( m \) rows and each row contains the Node ID of the first node that has \( id \geq i + 2^{j-1}\ mod\ 2^m \) where \( i \) is the id of the node that is building his finger table. Doing this we can considerably shrink the number of requests by <b>jumping</b> through the ring forwarding the request to the last node that has an id <b>smaller</b> than the key we're searching, reducing the number of steps to find the key to \( O(logN) \) with N as the number of the nodes inside the ring.</p>
<p>Being a distributed hash table the algorithm must permit other nodes to <b>join</b> and <b>leave</b> the ring. The join operation is done by initializing the new node's pointer to the successor and also we keep a pointer to the predecessor so we can correctly notify everyone of the new node joining. We also periodically run a procedure called <b>Stabilize</b> where a node \( i \) asks his successor \( n \) for his predecessor \( p \), if the pointers are not updated then \( n \)'s predecessor could be smaller than \( i \), in this case he updates it with the new id. \( n \) then answers with his predecessor \( p&#39; \) that can be \( i \) if the pointers are correct but it also can be a different id, in this case \( i \) has a chance to update his successor pointer to \( p&#39; \). By the end of this procedure we can assume that \( i \) and \( n \) pointers are updated.</p>
<p>More informations about the specifics of this algorithm can be found in <a href="https://pdos.csail.mit.edu/papers/ton:chord/paper-ton.pdf">this article</a> by I. Stoica, R. Morris et al. that also explains node departures and fail recoveries.</p>
<h1><a class="anchor" id="design_sec"></a>
Design</h1>
<p>In this project's case we use the Chord algorithm to implement a series of <b>mail servers</b> that work toghether to balance their load and exchange messages to deliver mail.</p>
<p>Each node implements a series of services to function correctly:</p><ul>
<li><b>Ping</b>: service used to check if a node is online</li>
<li><b>SearchFinger</b>: used to build the finger table, a node is returned for a given key</li>
<li><b>NodeJoin</b>: used by a node to join the ring, it returns the node that should be the successor of the calling node</li>
<li><b>Stabilize</b>: first part of the stabilize procedure, the predecessor node is returned</li>
<li><b>LookupMailbox</b>: search primitive for the DHT</li>
<li><b>InsertMailbox</b>: insert primitive for the DHT</li>
<li><b>Delete</b>: delete primitive for the DHT</li>
<li><b>Transfer</b>: used to transfer multiple mailboxes between nodes</li>
<li><b>Authenticate</b>: authentication service used by the nodes to check if a combination of address and password is correct</li>
<li><b>Send</b>: sends a mail message</li>
<li><b>Receive</b>: returns the messages of a mailbox</li>
</ul>
<p>These services are implemented in a Node class that handles all the communication steps and also the technicalities required by the system and the algorithm however the mail part is in a separated module, this is done to re-use the same components also for the client module, that gives an interface to a desktop application to operate with this system.</p>
<p>Each node's id is given by <b>hashing</b> the combination of ip address and network port, this is already a pretty much unique identifier of a process and permits to execute <b>multiple nodes</b> on the same machine without the use of multiple network cards or virtual machines. The same process is done to extract a key from a mailbox, the <b>mailbox owner</b> is considered as a unique identifier and then the string is hashed and used as an id. This id will be later used to find which node is the successor node for a given mailbox, the <b>client</b> can then connect to it and operate on the mailbox using the services listed above.</p>
<p>The project is composed by three executables:</p><ul>
<li><b>chord_server</b>: builds a ring from a JSON file called <em>cfg.json</em></li>
<li><b>node_server</b>: builds a single node and inserts it into the ring</li>
<li><b>chord_client</b>: client used to send and receive mail</li>
</ul>
<h1><a class="anchor" id="tech_sec"></a>
Technology</h1>
<p>The language used is C++17 to reduce the server-side overhead.</p>
<p>For the <b>communication</b> between nodes and between node and client <a href="https://grpc.io/">gRPC</a> is used, this framework is well-tested and used in big production environments and provides a more modern <b>interface</b> using <a href="https://developers.google.com/protocol-buffers">Protocol Buffers</a> to exchange data, in this way the definition of the messages fields and services is separated from the actual code that runs it, also the data translation from a machine to another is transparent to the programmer and provides support to STL data types such as std::string.</p>
<p>The <b>hashing</b> functions are provided by <a href="https://gnupg.org/software/libgcrypt/index.html">libgcrypt</a>, this library was preferred among others just because is usually already installed on linux environments and is pretty lightweight compared to others. The library is used for the Node id and key but also to hash the mailboxes' passwords.</p>
<p>The client uses the <a href="https://www.qt.io/">Qt</a> toolkit and the server uses <a href="https://invisible-island.net/ncurses/">ncurses</a> for the user interface. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
